---
name: browser-verify
description: Receipt Scanner アプリの動作検証を chrome-devtools-mcp を使って自動実行する
---

## 前提条件

- Backend が `http://localhost:8000` で起動していること
- Frontend が `http://localhost:5173` で起動していること
- Chrome ブラウザが起動していること
- chrome-devtools-mcp が MCP 設定に追加されていること

## 実行手順

### Step 1: ブラウザでアプリを開く

chrome-devtools-mcp の `navigate_page` ツールで `http://localhost:5173` にアクセスする。

### Step 2: 正常系テストシナリオを実行

以下のシナリオを順番に実行し、各ステップで `take_screenshot` を実行してエビデンスを保存する。

#### テスト1: 初期画面の表示確認

1. `http://localhost:5173` にアクセス
2. スクリーンショットを撮影
3. 確認項目:
   - Header に「Receipt Scanner」が表示されている
   - 画像アップロード領域が表示されている
   - 右カラムに「レシート画像をアップロードすると〜」のプレースホルダーが表示されている

#### テスト2: レシート画像アップロード → AI解析 → 結果表示

1. `upload_file` ツールでテスト用レシート画像をアップロード（対象: ImageUploader のファイル入力）
2. 「スキャン開始」ボタンを `click` で押下
3. ローディング中のスクリーンショットを撮影（スケルトンUIが表示されていること）
4. 解析完了まで `wait_for` で待機
5. 解析結果のスクリーンショットを撮影
6. 確認項目:
   - 店名・日付・金額・品目が表示されている
   - 「編集」「新しいレシートをスキャン」ボタンが表示されている

#### テスト3: 解析結果の編集 → 保存

1. 「編集」ボタンを `click` で押下
2. 編集フォームのスクリーンショットを撮影
3. 店名フィールドを `fill` で変更（例: 「テスト店舗」に変更）
4. 「保存」ボタンを `click` で押下
5. Toast通知（「保存しました」）が表示されることを確認
6. 保存後のスクリーンショットを撮影
7. 確認項目:
   - 変更した店名が反映されている
   - 編集モードが解除されている

#### テスト4: 履歴ページの表示確認

1. Header の「履歴」リンクを `click` で押下
2. `http://localhost:5173/history` に遷移したことを確認
3. スクリーンショットを撮影
4. 確認項目:
   - テスト2で保存したレシートが一覧に表示されている
   - 店名・金額・日付が正しい

#### テスト5: レシート詳細画面の表示・削除

1. 一覧のレシートカードを `click` で押下
2. 詳細画面のスクリーンショットを撮影
3. 確認項目:
   - 左カラムにレシート画像が表示されている
   - 右カラムに解析結果が表示されている
   - 「編集」「削除」ボタンが表示されている
4. 「削除」ボタンを `click` で押下
5. 確認ダイアログで「OK」を `handle_dialog` で押下
6. 履歴ページに自動遷移したことを確認
7. スクリーンショットを撮影

### Step 3: 異常系テストシナリオを実行

#### テスト6: 不正ファイル形式のアップロード

1. `http://localhost:5173` にアクセス
2. テキストファイル（.txt）を `upload_file` でアップロード
3. スクリーンショットを撮影
4. 確認項目:
   - エラーメッセージが表示される（「JPEG、PNG、WebP形式のみ対応しています」）

#### テスト7: 存在しないレシートIDへのアクセス

1. `navigate_page` で `http://localhost:5173/receipts/99999` にアクセス
2. スクリーンショットを撮影
3. 確認項目:
   - エラーメッセージが表示される（「レシートの取得に失敗しました」）

### Step 4: スクリーンショットの保存

各テストで撮影したスクリーンショットを以下のファイル名で `docs/evidence/` に保存する:

| テスト | ファイル名 |
|---|---|
| テスト1: 初期画面 | `docs/evidence/01_initial_screen.png` |
| テスト2: 解析結果 | `docs/evidence/02_scan_result.png` |
| テスト3: 編集後 | `docs/evidence/03_after_edit.png` |
| テスト4: 履歴一覧 | `docs/evidence/04_history_page.png` |
| テスト5: 詳細画面 | `docs/evidence/05_detail_page.png` |
| テスト5: 削除後 | `docs/evidence/06_after_delete.png` |
| テスト6: 不正形式 | `docs/evidence/07_invalid_file.png` |
| テスト7: 存在しないID | `docs/evidence/08_not_found.png` |

### Step 5: 検証レポートの生成

すべてのテスト完了後、`docs/evidence/REPORT.md` を以下のフォーマットで生成する:

```markdown
# Receipt Scanner 検証レポート

## 実施日時
YYYY-MM-DD HH:MM

## 環境
- OS: Windows 11
- ブラウザ: Chrome
- Backend: FastAPI (localhost:8000)
- Frontend: Vite + React (localhost:5173)

## テスト結果サマリ

| # | テスト名 | 結果 | 備考 |
|---|---|---|---|
| 1 | 初期画面の表示確認 | ✅ / ❌ | |
| 2 | アップロード→解析→結果表示 | ✅ / ❌ | |
| 3 | 編集→保存 | ✅ / ❌ | |
| 4 | 履歴ページ表示 | ✅ / ❌ | |
| 5 | 詳細画面・削除 | ✅ / ❌ | |
| 6 | 不正ファイル形式 | ✅ / ❌ | |
| 7 | 存在しないID | ✅ / ❌ | |

## 各テスト詳細

### テスト1: 初期画面の表示確認
- 結果: ✅ / ❌
- スクリーンショット: ![初期画面](01_initial_screen.png)
- 確認事項:
  - [ ] Header表示
  - [ ] アップロード領域表示
  - [ ] プレースホルダー表示

（以下、各テストについて同様の形式で記載）

## 不具合一覧

| # | 内容 | 重要度 | 対応状況 |
|---|---|---|---|
| - | - | - | - |

## 総合判定
✅ 全テスト合格 / ❌ 要修正あり
```
