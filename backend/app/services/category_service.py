"""品目キーワードからカテゴリを補助分類するサービス。"""

# キーワード → カテゴリ の辞書（品目名に含まれるキーワードで判定）
KEYWORD_MAP: dict[str, str] = {
    # 食費
    "おにぎり": "食費",
    "弁当": "食費",
    "サンドイッチ": "食費",
    "パン": "食費",
    "牛乳": "食費",
    "豆腐": "食費",
    "野菜": "食費",
    "肉": "食費",
    "魚": "食費",
    "米": "食費",
    "コーヒー": "食費",
    "茶": "食費",
    "ジュース": "食費",
    "ビール": "食費",
    "酒": "食費",
    "菓子": "食費",
    "ヨーグルト": "食費",
    "ラーメン": "食費",
    "寿司": "食費",
    "うどん": "食費",
    "そば": "食費",

    # 交通費
    "タクシー": "交通費",
    "バス": "交通費",
    "電車": "交通費",
    "切符": "交通費",
    "定期": "交通費",
    "ガソリン": "交通費",
    "駐車": "交通費",
    "高速": "交通費",

    # 日用品
    "洗剤": "日用品",
    "ティッシュ": "日用品",
    "トイレットペーパー": "日用品",
    "シャンプー": "日用品",
    "石鹸": "日用品",
    "歯ブラシ": "日用品",
    "歯磨き": "日用品",
    "ゴミ袋": "日用品",
    "電池": "日用品",

    # 医療費
    "薬": "医療費",
    "処方": "医療費",
    "診察": "医療費",
    "検査": "医療費",
    "湿布": "医療費",
    "絆創膏": "医療費",
    "目薬": "医療費",

    # 教育・書籍
    "書籍": "教育・書籍",
    "本": "教育・書籍",
    "雑誌": "教育・書籍",
    "ノート": "教育・書籍",
    "ペン": "教育・書籍",
    "文房具": "教育・書籍",

    # 衣服・美容
    "シャツ": "衣服・美容",
    "靴": "衣服・美容",
    "クリーニング": "衣服・美容",
    "美容": "衣服・美容",
    "化粧": "衣服・美容",
}


def classify_by_items(items: list[dict[str, str | float | None]]) -> str | None:
    """品目リストからキーワードマッチでカテゴリを推定する。

    Args:
        items: [{"name": "品名", ...}, ...] 形式のリスト

    Returns:
        推定カテゴリ文字列。判定不能なら None。
    """
    category_counts: dict[str, int] = {}

    for item in items:
        name = item.get("name") or ""
        for keyword, category in KEYWORD_MAP.items():
            if keyword in name:
                category_counts[category] = category_counts.get(category, 0) + 1
                break

    if not category_counts:
        return None

    # 最も多いカテゴリを返す
    return max(category_counts, key=lambda k: category_counts[k])
